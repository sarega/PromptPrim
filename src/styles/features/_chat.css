/* ===============================================
   FILE: src/styles/features/_chat.css (Definitive Fix)
   == CHAT BUBBLE & LAYOUT - REFACTORED VERSION ==
   =============================================== */

/* --- 1. The Turn Wrapper (The "Lane") --- */
/* ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Bubble ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô */

.message-turn-wrapper {
    display: flex;
    flex-direction: column;
    width: 100%;
    
    /* [KEY] ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ä‡∏ó */
    max-width: 820px; /* ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
}

.message-turn-wrapper.user-turn {
    align-items: flex-end;      /*<-- [FIX] ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
    position: relative; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡∏π‡∏Å */
    padding-top: 1.5em; 
}

.message-turn-wrapper.assistant-turn {
    align-items: flex-start; /* ‡∏à‡∏±‡∏î Bubble ‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
}

.message-turn-wrapper.system-turn {
    align-items: center; /* ‡∏à‡∏±‡∏î Bubble ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á */
}


/* --- 2. The Message Bubble (Base styles) --- */
/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bubble ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */

.message {
    padding: 12px 18px;
    border-radius: 18px;
    position: relative;
    line-height: 1.6;
    outline: none;
    box-sizing: border-box;
    max-width: 90%; /* Bubble ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 90% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏ô */
}

.message-content {
    word-wrap: break-word; /* ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
}


/* --- 3. Specific Bubble Styles --- */

.message.user {
     background-color: #eaf5fe;
    color: var(--user-bubble-edit-text-color);
    display: table; /* ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ display: table ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Performance */
    
    /* [FIX] ‡πÄ‡∏û‡∏¥‡πà‡∏° 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡πÉ‡∏ô User Bubble */
    table-layout: fixed; 
    /* width: 100%; */

    /* ‡∏™‡πà‡∏ß‡∏ô max-width: 90% ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ */
    max-width: 90%; 
    border-radius: 18px;
}

.message.assistant {
    background: white;
    border: 1px solid var(--border-color);
    border-bottom-left-radius: 5px;
    width: 100%;      /* ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Markdown ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
    max-width: 100%;
}

.message.system {
    max-width: fit-content; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
    text-align: center;
    background: #f0f4f8;
    color: #64748b;
    font-style: italic;
    font-size: 0.85rem;
    padding: 8px 15px;
    border-radius: 15px;
    border: 1px solid var(--border-color);
}


/* --- 4. Paragraph & List Spacing (The Final Fix) --- */
/* ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å Markdown */

.message-content > * {
    margin-top: 0;
    margin-bottom: 0;
}
.message-content > * + * {
    margin-top: 1em;
}
.message-content > *:last-child {
    margin-bottom: 0;
}

/* Container for the assistant's response bubble */
.message.assistant .message-content {
    line-height: 1.7;
}

/* Style for H3 headings like "Key Takeaways" and "Sources" */
.message-content h3 {
    font-size: 1.1rem;
    font-weight: 700;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
    padding-bottom: 0.3em;
    border-bottom: 1px solid var(--border-color);
}

/* Style for bullet points (Key Takeaways) */
.message-content ul {
    list-style: none; /* Remove default bullet */
    padding-left: 0;
}

.message-content ul li {
    padding-left: 1.5em;
    position: relative;
    margin-bottom: 0.5em;
}

.message-content ul li::before {
    content: 'üîπ'; /* Custom bullet point */
    position: absolute;
    left: 0;
    top: 0;
    color: var(--primary-color);
}

/* Style for numbered list (Sources) */
.message-content ol {
    padding-left: 1.5em;
    list-style-position: outside;
}

.message-content ol li {
    margin-bottom: 0.5em;
    padding-left: 0.5em;
}

/* Dark Mode Adjustments */
body.dark-mode .message-content ul li::before {
    color: var(--accent-color);
}

/* --- 5. Action Menu (Preserved from your original code) --- */
/* ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£ */

.message-actions {
    position: absolute;
    bottom: -32px; /* << ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ bottom ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏´‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î */
    display: flex;  /* << ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å none ‡πÄ‡∏õ‡πá‡∏ô flex */
    gap: 5px;
    background: transparent; /* << ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ */
    backdrop-filter: none;   /* << ‡πÄ‡∏≠‡∏≤‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏ö‡∏•‡∏≠‡∏≠‡∏≠‡∏Å */
    padding: 4px;
    border: none;            /* << ‡πÄ‡∏≠‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏≠‡∏≠‡∏Å */
    opacity: 1;              /* << ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô */
    z-index: 10;
}

.message.user .message-actions { left: auto; right: 4px; }
.message.assistant .message-actions { left: 4px; }
.message-actions button {
    background: transparent;
    border: none;
    width: 28px;
    height: 28px;
    font-size: 16px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.message.user .message-actions button { color: rgba(0, 0, 0, 0.7); }
.message-actions button:hover { background: #e2e8f0; color: var(--text-dark); }
.message.user .message-actions button:hover { background: rgba(0, 0, 0, 0.3); color: white; }


/* --- 6. Other Styles (Images, Editing State) --- */

.message-content img.multimodal-image {
    display: block;
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    margin-top: 10px;
    object-fit: contain;
}

.message.is-editing {
    width: 100% !important;
    max-width: 100% !important;
    min-height: 5em;
}

.message-turn-wrapper.is-editing-child {
    width: 100%;
}

.message.user .inline-edit-textarea {
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--user-bubble-edit-text-color) !important;
    border-color: var(--text-light);
}


/* --- ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å Markdown --- */

/* 1. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å element ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á */
.message.assistant .message-content > * {
    margin-top: 0;
    margin-bottom: 0;
}

.message.assistant .message-content img {
   display: block;
   max-width: 100%;
   max-height: 60vh;
   height: auto;
   object-fit: contain;
   margin: 5px 0;
   border-radius: 8px;
   box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* 2. [‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á "‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" ‡∏Ç‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô */
.message.assistant .message-content p + p {
    margin-top: 1em; /* ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
}

/* 3. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á List ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) */
.message.assistant .message-content ul,
.message.assistant .message-content ol,
.message.assistant .message-content pre {
    margin-top: 0.75em;
    margin-bottom: 0.75em;
}

/* 4. ‡∏•‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Element ‡∏ï‡∏±‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á bubble */
.message.assistant .message-content > *:last-child {
    margin-bottom: 0 !important;
}
/* =========================== */

.speaker-label-wrapper {
    margin-bottom: 5px;
    padding: 0 10px;
}
.speaker-label {
    font-weight: bold;
    font-size: 0.9em;
    color: #2563eb; /* <--- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.inline-edit-actions {
    display: flex;
    gap: 10px;
    margin-top: 8px;
    justify-content: flex-end;
}

/* CSS for seamless inline editing bubble */

/* 2. ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Edit Container ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏î‡∏ß‡∏≤‡∏á (Wrapper) */
.inline-edit-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 0.5em; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á textarea ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° */
    /* *** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ background, padding, border-radius ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á *** */
}

/* 3. ‡∏à‡∏±‡∏î‡∏™‡πÑ‡∏ï‡∏•‡πå Textarea ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ */
.inline-edit-textarea {
    width: 100%;
    box-sizing: border-box;
    font-family: inherit;
    font-size: 1em;
    border: 1.5px solid #bbb;
    border-radius: 0.8em;
    padding: 0.5em 0.8em;
    outline: none;
    transition: border 0.2s;
    
    /* [CRITICAL] ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô scrollbar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ JS ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà */
    resize: none;
    overflow-y: hidden;
}

.inline-edit-textarea:focus {
    border: 1.5px solid #2866d9;
    box-shadow: 0 0 3px #2866d988;
}

body.dark-mode .inline-edit-textarea:focus {
    border-color: #7f9cf5;
    box-shadow: 0 0 3px rgba(127, 156, 245, 0.5);
}


/* --- [REFACTORED] Chat Input Area --- */
.chat-input-wrapper {
    background: transparent;
    /* [FIX] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å padding ‡πÄ‡∏î‡∏¥‡∏° ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô padding ‡∏ö‡∏ô-‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
    padding: 10px 20px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏ö‡∏ô 10px ‡πÅ‡∏•‡∏∞‡∏•‡πà‡∏≤‡∏á 10px */
    flex-shrink: 0;
    position: relative;
    z-index: 30;
    display: flex;
    flex-direction: column;
}

#file-preview-container + .chat-input-wrapper {
    margin-top: 12px;
}

.chat-panel-bottom {
    position: relative;
    z-index: 30; /* ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ Composer */
}

.input-container-seamless {
    position: relative;
    width: 100%;
    background-color: var(--bg-color-secondary); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô */
    border: 1px solid var(--border-color);
    border-radius: 24px;
    display: flex;
    align-items: center;
    padding: 5px;
    transition: all 0.2s ease;
    
}

.input-container-seamless:focus-within {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px var(--shadow-light);
    background: transparent !important;
    
}
#chatInput {
    flex-grow: 1;
    width: 100%;
    background-color: transparent;
    border: none;
    border-radius: 24px;
    resize: none;
    line-height: 1.5;
    color: var(--text-dark);
    max-height: 200px;
    overflow-y: auto;
    margin: 0;
    min-height: 38px;
    padding: 8px 10px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}
#chatInput::-webkit-scrollbar { display: none; }
#chatInput:focus { outline: none; box-shadow: none; }

/* --- New Gemini-style Input Layout --- */

/* ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏£‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
.input-container-seamless {
  flex-direction: column;
  align-items: stretch; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ textarea ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° */
  padding: 12px 12px 8px 12px; /* ‡∏õ‡∏£‡∏±‡∏ö padding ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
}

/* Textarea: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
#chatInput {
  background: transparent;
  border: none;
  padding: 0 4px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
  margin-bottom: 8px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏õ‡∏∏‡πà‡∏° */
  min-height: 24px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
}

/* ‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°: ‡∏à‡∏±‡∏î‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô */
.input-actions-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡∏ß‡∏≤ */
.input-actions-left, .input-actions-right {
  display: flex;
  align-items: center;
  gap: 8px; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
}

/* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏° send/stop ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏ß‡∏Å */
.input-actions-right .btn {
    width: 36px;
    height: 36px;
}

#chat-actions-btn {
    width: 36px;
    height: 36px;
    font-size: 18px;
    padding: 0;
    color: #5f6368;
    background: none !important;
    border: none !important;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}
#sendBtn, #stopBtn {
    width: 36px;
    height: 36px;
    font-size: 16px;
    padding: 0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* The #stopBtn is now hidden by the .hidden class in index.html, not here */

#chat-actions-menu {
    position: absolute;
    bottom: 110%;
    left: 0;
    background-color: white;
    min-width: 250px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.15);
    z-index: 100;
    border-radius: 8px;
    overflow: hidden;
    padding: 5px 0;
    border: 1px solid var(--border-color);
}
#chat-actions-menu a {
    color: var(--text-dark);
    padding: 8px 14px;
    text-decoration: none;
    display: block;
    font-size: 0.95rem;
    cursor: pointer;
}
#chat-actions-menu a:hover { background-color: #f1f1f1; }

/* --- File Previews --- */


/* [FIX] ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏≤‡∏™ .hidden ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
#file-preview-container.hidden {
    display: none !important; /* ‡πÉ‡∏ä‡πâ !important ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô */
    margin-bottom: 0;
    
}

#file-preview-container {
    display: grid; /* ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px; 
    margin-bottom: 12px; /* [FIX] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
    padding: 0;
    background: transparent; 
    width: 100%;
}

.file-preview-item {
    position: relative; border-radius: 8px; overflow: hidden;
    aspect-ratio: 1 / 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    background-color: #f0f4f8; border: 1px solid var(--border-color);
}
.file-preview-thumbnail { width: 100%; height: 100%; object-fit: cover; }
.file-preview-thumbnail.file-icon {
    font-size: 48px; color: #718096;
    display: flex; align-items: center; justify-content: center;
}
.file-preview-name {
    position: absolute; bottom: 0; left: 0; right: 0;
    font-size: 12px; font-weight: 500; background: rgba(0, 0, 0, 0.5);
    color: white; padding: 4px 6px; white-space: nowrap;
    overflow: hidden; text-overflow: ellipsis; text-align: center;
}
.remove-file-btn {
    position: absolute; top: 4px; right: 4px;
    background: rgba(0, 0, 0, 0.6); color: white;
    border-radius: 50%; border: 1.5px solid white;
    width: 22px; height: 22px; cursor: pointer; font-weight: bold;
    display: flex; align-items: center; justify-content: center;
    line-height: 1; font-size: 14px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3); z-index: 2;
    transition: background 0.2s ease;
}
.remove-file-btn:hover { background: rgba(229, 62, 62, 0.9); }

/* ========================================================
   == DEFINITIVE STYLES FOR CHAT BUBBLE CONTENT        ==
   == (Place this in _chat.css)                        ==
   ======================================================== */

/* --- 1. Bubble Layout & Alignment --- */
/* ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° "‡πÄ‡∏•‡∏ô" ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ */
.message-turn-wrapper {
    display: flex;
    flex-direction: column;
    width: 100%;
    max-width: 820px;
}

.message-turn-wrapper.assistant-turn { align-items: flex-start; }
.message-turn-wrapper.system-turn { align-items: center; }

/* --- 2. Base Bubble Style --- */
/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Bubble ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
.message {
    padding: 12px 18px;
    border-radius: 18px;
    position: relative;
    max-width: 90%;
}
.message-content {
    word-wrap: break-word;
    line-height: 1.6;
}

/* --- 3. Markdown Content Styling (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) --- */
/* ‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö HTML ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å Markdown */

/* ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏Å‡πà‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ */
.message-content > * {
    margin: 0;
    padding: 0;
}

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á "‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Block ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
.message-content > * + * {
    margin-top: 0.75em;
}

/* ‡∏•‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á Element ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ */
.message-content > *:last-child {
    margin-bottom: 0 !important;
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Headings */
.message-content h1,
.message-content h2,
.message-content h3,
.message-content h4,
.message-content h5 {
    margin-top: 1.2em;
    margin-bottom: 0.6em;
    line-height: 1.3;
}

.message-content h1 { font-size: 1.8em; }
.message-content h2 { font-size: 1.5em; }
.message-content h3 { font-size: 1.25em; }

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Lists */
.message-content ul,
.message-content ol {
    padding-left: 1.6em;
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Blockquotes */
.message-content blockquote {
  border-left: 3px solid var(--border-color);
  padding: 0.4em 1em;
  background: #f7f7f7;
}
body.dark-mode .message-content blockquote {
  border-left-color: #56657a;
  background: rgba(110, 125, 175, 0.09);
}

/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tables */
.message-content table {
  border-collapse: collapse;
  margin: 1em 0;
  width: 100%;
  font-size: 0.95em;
  border: 1px solid var(--border-color);
}

.message-content th,
.message-content td {
  border: 1px solid var(--border-color);
  padding: 8px 12px;
  text-align: left;
}

/* [FIX] ‡πÉ‡∏™‡πà‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (th) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
.message-content th {
  font-weight: 600;
  background-color: #f6f8fa;
}
/* [FIX] ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (tr) ‡∏≠‡∏≠‡∏Å */
.message-content tr:nth-child(even) {
  background-color: transparent; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ß‡∏≠‡∏∑‡πà‡∏ô */
}

/* --- Dark Mode Overrides --- */
body.dark-mode .message-content th {
  background-color: #2d3748; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î */
}
body.dark-mode .message-content tr:nth-child(even) {
  background-color: transparent;
}

body.dark-mode .message-content th {
  background-color: #202732;
}

/* --- Table Styling --- */
.message-content table {
  border-collapse: collapse;
  margin: 1em 0;
  width: 100%;
  font-size: 0.95em;
  border: 1px solid var(--border-color);
}

.message-content th,
.message-content td {
  border: 1px solid var(--border-color);
  padding: 8px 12px;
  text-align: left;
}

.message-content th {
  font-weight: 600;
  background-color: #f6f8fa;
}

.message-content tr:nth-child(even) {
  background-color: #f6f8fa;
}

/* Dark Mode for Tables */
body.dark-mode .message-content th {
  background-color: #202732;
}
body.dark-mode .message-content tr:nth-child(even) {
  background-color: #202732;
}

/* [PATCH] ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Summary Bubble ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ */
.message.system-summary-message {
    width: 100%; /* ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
    max-width: 100%;
    background: #eef2f7; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô */
    color: #4a5568;
    border: 1px dashed #d1d8e0; /* ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á */
    font-size: 0.9rem;
    padding: 15px 20px;
}
/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dark Mode */
body.dark-mode .message.system-summary-message {
    background: #232d3e;
    color: #a0aec0;
    border-color: #4a5568;
}

/* --- Timestamp Styling (Definitive Version) --- */
.message-timestamp {
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
  font-size: 0.75rem;
  color: #a0aec0; /* ‡∏™‡∏µ‡∏à‡∏≤‡∏á‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Light theme */
  pointer-events: none;
  font-weight: normal;
}

.message-turn-wrapper:hover .message-timestamp {
  opacity: 1;
}

/* --- Positioning --- */

/* For Assistant */
.speaker-info-wrapper {
  display: flex;
  align-items: baseline;
  gap: 8px; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ */
  margin-bottom: 5px;
  padding: 0 10px;
}
.speaker-info-wrapper .speaker-label {
  font-weight: bold;
  font-size: 0.9em;
  color: #2563eb;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

/* For User */


.user-turn > .message-timestamp {
  position: absolute;
  top: -0.2em; /* ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ Bubble */
  right: 8px;
}

/* --- Styles for Summary Marker in Chat --- */
.message.summary-marker {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #e6f4ea; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô */
    border: 1px solid #c8e6c9;
    color: #2e7d32;
}

body.dark-mode .message.summary-marker {
    background-color: #2c3e32;
    border-color: #4caf50;
    color: #a5d6a7;
}

.summary-marker-actions {
    display: flex;
    gap: 5px;
    margin-left: 15px;
}

.summary-marker-actions .btn-icon.small {
    width: 28px;
    height: 28px;
}
.summary-marker-actions .btn-icon.small .material-symbols-outlined {
    font-size: 18px;
}

.message-content img {
   display: block; /* Prevents extra space below the image */
   max-width: 100%; /* Ensure image doesn't exceed container width */
   max-height: 60vh; /* Optional: Set a maximum height relative to the viewport */
   height: auto; /* Maintain aspect ratio */
   object-fit: contain; /* Scale down to fit, preserving aspect ratio */
   margin: 5px 0; /* Add some vertical spacing around the image */
   border-radius: 8px; /* Optional: Add rounded corners */
   box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Optional: Add a subtle shadow */
}


/* [NEW] A shared class for any image inside a chat bubble,
  whether it's from a user or an assistant.
*/
.message-content img.multimodal-image {
    display: block; /* Prevents extra space below the image */
    max-width: 100%; /* Ensures the image is never wider than the bubble */
    max-height: 50vh; /* Limits the height to half the screen height */
    height: auto; /* Maintains the aspect ratio */
    border-radius: 12px; /* Adds nice rounded corners */
    margin-top: 8px;
    margin-bottom: 8px;
    object-fit: contain; /* Scales the image down to fit, preserving its shape */
}

