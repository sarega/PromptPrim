/* ===============================================
   FILE: src/styles/themes/_dark-mode.css (สมบูรณ์)
   DESCRIPTION: Theme สี Dark กลืนทุก element + วงกลม action โปร่งใส + ปรับ #agent-enhancer-column
   =============================================== */

body.dark-mode {
    --primary-color: #7f9cf5;
    --secondary-color: #a78bfa;
    --background-gradient: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
  
    --text-dark: #e2e8f0;
    --text-light: #1a202c;
    --border-color: #4a5568;
    --white-alpha-95: rgba(26, 32, 44, 0.85);
    --white-alpha-50: rgba(45, 55, 72, 0.5);
    /* [NEW] Workspace Background Overrides for Dark Mode */
    --bg-workspace-chat: #1e293b;   /* สีเทาน้ำเงินเข้มสำหรับหน้าแชท */
    --bg-workspace-studio: #1e293b; /* สีเทาน้ำเงินเข้มสำหรับหน้า Studio */ 
    --user-bubble-text-color: #e2e8f0; /* <--- เพิ่มบรรทัดนี้ (สีเทาอ่อนเกือบขาว) */
    --user-bubble-edit-text-color: #f7fafc; /* <--- เพิ่มบรรทัดนี้ */
    --primary-color-dark: #394990; /* <--- เพิ่มบรรทัดนี้ */
    --btn-primary-bg: #2f3c4f;      /* <--- สีพื้นหลังที่คุณชอบ */
    --btn-primary-border: #4a5568;  /* <--- สีขอบที่เข้ากัน */
    --bg-admin-page: #1e293b; /* สีพื้นหลังสำหรับหน้า Admin (Dark) */
    --workspace-switcher-inactive-color: #94a3b8;
    --workspace-switcher-active-color: var(--text-dark);
    --workspace-switcher-hover-bg: rgba(74, 85, 104, 0.45);
    --workspace-switcher-active-bg: #3e4c5f;
    --workspace-switcher-active-shadow: 0 1px 3px rgba(0, 0, 0, 0.35);
    --workspace-switcher-divider-color: var(--border-color);
    --header-project-title-color: #e2e8f0;
    --header-chat-divider-color: rgba(148, 163, 184, 0.5);


    background: #1a202c;
    color: var(--text-dark);
}

/*
 * Specific background color for side panels in Dark Mode.
 * This rule targets the panels directly when dark mode is active.
 */
body.dark-mode .sessions-panel,
body.dark-mode .composer-panel {
    background-color: #1a202c; /* สีเทา-น้ำเงินที่เข้มกว่าพื้นหลังเล็กน้อย */
}

body.dark-mode .sidebar { background: var(--white-alpha-95); }
body.dark-mode #settings-panel { background: #2d3748; }
body.dark-mode .main-chat-area { background: #2d3748cc; }
body.dark-mode input[type="text"],
body.dark-mode input[type="password"],
body.dark-mode input[type="number"],
body.dark-mode select,
body.dark-mode textarea {
    background-color: #4a5568;
    color: var(--text-dark);
    border-color: #718096;
}
body.dark-mode .api-provider-switches {
    background: #1f2937;
    border-color: #4a5568;
}
body.dark-mode .api-provider-switch-title {
    color: #e2e8f0;
}
body.dark-mode .api-provider-switch-desc {
    color: #94a3b8;
}
body.dark-mode .api-toggle-track {
    background: #475569;
}
body.dark-mode .api-toggle input:checked + .api-toggle-track {
    background: #3b82f6;
}
body.dark-mode .api-toggle-track::before {
    background: #e2e8f0;
}
body.dark-mode input:-webkit-autofill,
body.dark-mode input:-webkit-autofill:hover,
body.dark-mode input:-webkit-autofill:focus,
body.dark-mode input:-webkit-autofill:active {
    -webkit-box-shadow: 0 0 0 30px #4a5568 inset !important;
    -webkit-text-fill-color: var(--text-dark) !important;
}
body.dark-mode .message.assistant { background: #232e42; border-color: #718096; } /* background: #4a5568 */
body.dark-mode .message.system { background: #4a5568; color: #a0aec0; border-color: #718096; }
body.dark-mode .item-list > .item { background-color: #2d3748; border-color: #4a5568; }
body.dark-mode .item-list > .item.active { border-color: var(--success-color); background-color: #2c4736; }
body.dark-mode .item-list > .item.staged {
    border-color: #fbbf24;
    border-left-width: 3px;
    background-color: #47350f;
    box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.28) inset;
}
body.dark-mode .item-list > .item:hover {
    background-color: #3e4c5f;
    border-color: #5a6b82;
}

/* [FIX] กำหนดสไตล์สำหรับลิงก์ใน Assistant Bubble ของ Dark Mode โดยเฉพาะ */
body.dark-mode .message.assistant .message-content a {
    color: #90caf9; /* สีฟ้าสว่างที่อ่านง่ายบนพื้นหลังสีเข้ม */
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
}

body.dark-mode .message.assistant .message-content a:hover {
    color: #bbdefb; /* สีจะสว่างขึ้นเมื่อนำเมาส์ไปวาง */
}
/* [FIX]

/* [ADD THIS] เพิ่มกฎสำหรับ Item ที่ active และถูก hover พร้อมกัน */
body.dark-mode .item-list > .item.active:hover {
    background-color: #2c4736;          /* <--- ใช้สีเดียวกับ .active */
    border-color: var(--success-color); /* <--- ใช้สีขอบเดียวกับ .active */
}
body.dark-mode .item-list > .item.pinned { background-color: #3c3658; }
body.dark-mode .item-name { color: var(--text-dark); }
body.dark-mode .collapsible-section summary { color: #a0aec0; }
body.dark-mode .collapsible-section summary:hover { background-color: #4a5568; }
body.dark-mode .collapsible-section summary:hover h3 { color: var(--text-dark); }
body.dark-mode .summary-log-item { background: #2d3748; border-left-color: #4a5568; }
body.dark-mode .summary-log-item.active { border-left-color: var(--success-color); background: #2c4736; }
body.dark-mode .summary-log-item-title { color: #cbd5e0; }
body.dark-mode .memory-toggle { background: #718096; }
body.dark-mode .memory-toggle.active { background: var(--success-color); }
body.dark-mode .dropdown-content { background-color: #2d3748; border: 1px solid #4a5568; }
body.dark-mode .dropdown-content a { color: var(--text-dark); }
body.dark-mode .dropdown-content a:hover { background-color: #4a5568; }
body.dark-mode .dropdown-content hr { border-top-color: #4a5568; }
body.dark-mode .btn-icon { color: #a0aec0; }
body.dark-mode .btn-icon:hover { background: #4a5568; color: var(--text-dark); }
body.dark-mode .btn-secondary { background: #718096; color: #e2e8f0; }
body.dark-mode .modal-box { background: #2d3748; }
body.dark-mode .folder-settings-file-list {
  background: #1f2937;
  border-color: #4a5568;
}
body.dark-mode .folder-settings-file-item {
  color: #e2e8f0;
}
body.dark-mode .folder-settings-toggle-row {
  background: #1f2937;
  border-color: #4a5568;
}
body.dark-mode .folder-settings-toggle-title {
  color: #e2e8f0;
}
body.dark-mode .folder-settings-toggle-desc {
  color: #94a3b8;
}
body.dark-mode #context-inspector-modal pre { background: #1a202c; border-color: #4a5568; color: #cbd5e0; }
body.dark-mode #chat-actions-menu { background-color: #2d3748; border-color: #4a5568; }
body.dark-mode #chat-actions-menu a { color: var(--text-dark); }
body.dark-mode #chat-actions-menu a:hover { background-color: #4a5568; }
body.dark-mode .agent-enhancer-column {
  background-color: #1a202c !important; /* หรือ #232d3e */
  border-color: #4a5568 !important;
}body.dark-mode #group-member-list { border-color: #4a5568; }
body.dark-mode .agent-sortable-item { background-color: #2d3748; border-color: #4a5568; }
body.dark-mode .agent-sortable-item .drag-handle { color: #718096; }
body.dark-mode code { background-color: #4a5568; color: #f7fafc; }
body.dark-mode .message-content pre code { background-color: transparent; }
body.dark-mode .inline-edit-textarea { background-color: #2d3748; color: var(--text-dark); border-color: var(--primary-color); }
body.dark-mode hr { border-top-color: #4a5568; }
body.dark-mode *::-webkit-scrollbar-thumb { background-color: #718096; border-radius: 5px; border: 2px solid #2d3748; }
body.dark-mode *::-webkit-scrollbar-thumb:hover { background-color: #a0aec0; }
body.dark-mode *::-webkit-scrollbar { background: #21222c; }
body.dark-mode .modal-warning { color: #a0aec0; }
body.dark-mode .enhancer-status-box { color: #a0aec0; }
body.dark-mode .sidebar-resizer { background: #2d3748; border-top: 1px solid #4a5568; border-bottom: 1px solid #4a5568; }
body.dark-mode .sidebar-resizer:hover { background: var(--primary-color); opacity: 0.6; }
/* [ADD THIS] เพิ่มกฎสำหรับ User Bubble โดยเฉพาะใน Dark Mode */
body.dark-mode .message.user {
    background: #070a11; /* หรือสีน้ำเงินเข้มอื่นๆ ที่คุณต้องการ #1a202c*/
    color: var(--user-bubble-text-color); /* ใช้ตัวแปรที่เราสร้างไว้ */
}

/* [VERIFY/FIX THIS] แก้ไขกฎสำหรับ Textarea ตอน Edit ให้สมบูรณ์ */
body.dark-mode .message.user .inline-edit-textarea {
    background-color: rgba(10, 10, 25, 0.3); /* พื้นหลังให้เข้มขึ้นเล็กน้อย */
    color: var(--user-bubble-edit-text-color) !important; /* ใช้ !important เพื่อความชัวร์ */
    border-color: #1a202c; /* สีขอบให้เข้ากับสี Bubble ใหม่ */
}
body.dark-mode .input-container-seamless { background-color: #2d3748; border-color: #4a5568; }
body.dark-mode .input-container-seamless:focus-within { box-shadow: 0 0 0 3px rgba(127, 156, 245, 0.4); border-color: var(--primary-color); }
body.dark-mode #chatInput { color: #e2e8f0; }
body.dark-mode #chatInput::placeholder { color: #a0aec0; }
body.dark-mode #chat-actions-btn { color: #bdc1c6; }
body.dark-mode .speaker-label { color: var(--primary-color); }
body.dark-mode .file-preview-item { background-color: #2d3748; border-color: #4a5568; }
body.dark-mode .knowledge-file-meta { color: #a0aec0; }
body.dark-mode .knowledge-file-excerpt { color: #d3dce6; }
body.dark-mode .knowledge-file-note { color: #fdba74; }
body.dark-mode .knowledge-item.selected-for-rag { background-color: #12303d; border-color: #38bdf8; }
body.dark-mode .knowledge-item.source-focused {
    background-color: #0d2d3f;
    border-color: #38bdf8;
    box-shadow: 0 0 0 1px #0ea5e9 inset;
}
body.dark-mode .knowledge-item .btn-icon.is-active { color: #67e8f9 !important; }
body.dark-mode .knowledge-focus-preview {
    background: #0f172a;
    border-color: #334155;
}
body.dark-mode .knowledge-focus-preview-title { color: #bfdbfe; }
body.dark-mode .knowledge-focus-preview-text { color: #e2e8f0; }
body.dark-mode .knowledge-control { color: #d1d5db; }
body.dark-mode .knowledge-control input,
body.dark-mode .knowledge-control select {
  background-color: #1f2937;
  border-color: #4b5563;
  color: #e5e7eb;
}
body.dark-mode .knowledge-scope-info { color: #cbd5e1; }
body.dark-mode .rag-source-title { color: #cbd5e1; }
body.dark-mode .rag-source-chip {
  border-color: #2c4f75;
  background: #10243d;
  color: #c5e2ff;
}
body.dark-mode .rag-source-chip:hover {
  border-color: #4d78a8;
  background: #16304f;
}
body.dark-mode .rag-source-chip:focus-visible {
  outline-color: #7dd3fc;
}
body.dark-mode .rag-debug-panel {
  border-color: #3c4c63;
  background: #1b2433;
}
body.dark-mode .rag-debug-summary { color: #e2e8f0; }
body.dark-mode .rag-debug-reason { color: #94a3b8; }
body.dark-mode .rag-debug-item {
  border-color: #3f4c61;
  background: #111827;
}
body.dark-mode .rag-debug-item-title { color: #dbeafe; }
body.dark-mode .rag-debug-item-excerpt { color: #cbd5e1; }
body.dark-mode .message-actions button.active {
  background: #1d3557 !important;
  color: #bfdbfe !important;
}
body.dark-mode .session-info-content pre {
  background: #111827;
  border-color: #334155;
  color: #e2e8f0;
}
body.dark-mode .context-debugger-card {
  background: #1f2937;
  border-color: #374151;
}
body.dark-mode .context-debugger-page {
  background: #0f172a;
}
body.dark-mode .context-debugger-page-header {
  background: #0b1220;
  border-color: #334155;
}
body.dark-mode .context-debugger-page-title h3 {
  color: #e2e8f0;
}
body.dark-mode #context-debugger-back-btn {
  color: #cbd5e1;
}
body.dark-mode #context-debugger-back-btn:hover {
  background: #1f2937;
}
body.dark-mode .context-debugger-card .label { color: #94a3b8; }
body.dark-mode .context-debugger-card .value { color: #e2e8f0; }
body.dark-mode .context-debugger-turns-panel,
body.dark-mode .context-debugger-detail-panel {
  background: #111827;
  border-color: #374151;
}
body.dark-mode .context-debugger-turn-item {
  background: #1f2937;
  border-color: #374151;
}
body.dark-mode .context-debugger-turn-item.active {
  background: #0f2842;
  border-color: #38bdf8;
}
body.dark-mode .context-debugger-turn-item-role { color: #94a3b8; }
body.dark-mode .context-debugger-turn-item-title { color: #e5e7eb; }
body.dark-mode .context-debugger-turn-item-meta { color: #cbd5e1; }
body.dark-mode .context-debugger-turn-detail,
body.dark-mode .context-debugger-turn-detail pre,
body.dark-mode #context-debugger-assembly {
  background: #0b1220;
  border-color: #334155;
  color: #e2e8f0;
}
body.dark-mode .context-debugger-empty { color: #94a3b8; }
body.dark-mode .session-item-meta { color: #94a3b8; }
body.dark-mode [data-session-drop-target].is-drop-target {
  background: #0f2842;
  outline-color: #38bdf8;
}
body.dark-mode .session-folder {
  background: #1f2937;
  border-color: #374151;
}
body.dark-mode .session-folder-summary { color: #e2e8f0; }
body.dark-mode .session-folder-count {
  background: #334155;
  color: #e2e8f0;
}
body.dark-mode .session-item.session-locate-highlight {
  background-color: #10384a;
  box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.38);
}
body.dark-mode .session-list-locate-trigger:hover {
  background: #334155;
}
body.dark-mode .session-organize-heading {
  color: #94a3b8;
}
body.dark-mode .session-organize-option.is-selected {
  background: #334155;
  color: #e2e8f0;
}
body.dark-mode .session-organize-option .session-organize-check {
  color: #93c5fd;
}
body.dark-mode .folder-session-sort-option.is-selected {
  background: #334155;
  color: #e2e8f0;
}
body.dark-mode .folder-session-sort-option .folder-session-sort-check {
  color: #93c5fd;
}
body.dark-mode .folder-session-list {
  background: #111827;
  border-top-color: #374151;
  border-left-color: #334155;
}

/* --- Item-specific styling for Dark Mode --- */
body.dark-mode .sidebar .session-item.archived .item-name { color: #919191; }
body.dark-mode .session-item.archived { opacity: 0.8; }
body.dark-mode .item-list > .group-item { background-color: #3a4454; border-left-color: var(--primary-color);}
body.dark-mode .inactive .item-name { opacity: 0.9; }
body.dark-mode .sidebar .memory-item.inactive .item-name { color: #b6b6b6;}

/* Section heading ถ้าใช้ <summary> (เช่น Chat Session, Agent Groups ฯลฯ) */
body.dark-mode .collapsible-section > summary {
  color: #c9d1d9;
  font-weight: 600;
  letter-spacing: 0.5px;
}
/* ถ้าใช้ h3/h4 ใน sidebar */
body.dark-mode .sidebar h3,
body.dark-mode .sidebar h4 {
  color: #c9d1d9;
  font-weight: 600;
}
/* ถ้าใช้ label หรือ .section-title */
body.dark-mode .sidebar label,
body.dark-mode .sidebar .section-title {
  color: #c9d1d9;
  font-weight: 600;
}


/* [NEW] ปุ่ม Edit/Delete/3จุด: วงกลมโปร่งใส, hover มีสี */
body.dark-mode .session-item button,
body.dark-mode .session-item .item-action,
body.dark-mode .agent-preset button,
body.dark-mode .agent-preset .item-action {
  background: transparent !important;
  color: #c9d1d9 !important;
  border-radius: 50%;
  border: none;
  transition: background 0.12s;
}

/* [NEW] Hover แล้ววงกลมสีอ่อน */
body.dark-mode .session-item button:hover,
body.dark-mode .session-item .item-action:hover,
body.dark-mode .agent-preset button:hover,
body.dark-mode .agent-preset .item-action:hover {
  background: #334155 !important;
  color: #fff !important;
}
/* [ปุ่มใน หัวข้อ section ใน side bar  */
body.dark-mode .btn-icon {
  background: transparent !important;
  color: #c9d1d9 !important;
  border: none;
}
body.dark-mode .btn-icon:hover {
  background: #334155 !important;
  color: #fff !important;
}
body.dark-mode .chat-title:hover {
  background: #334155;
}

body.dark-mode .book-agent-header-badge {
  background: rgba(49, 46, 129, 0.28);
  border-color: #4f46e5;
  color: #c7d2fe;
}
body.dark-mode .book-agent-header-badge:hover {
  background: rgba(79, 70, 229, 0.32);
  border-color: #6366f1;
  color: #e0e7ff;
}
body.dark-mode .book-agent-header-badge.is-auto-on {
  background: rgba(30, 58, 138, 0.30);
  border-color: #3b82f6;
  color: #bfdbfe;
}
body.dark-mode .book-agent-header-badge.has-pending {
  background: rgba(120, 53, 15, 0.30);
  border-color: #f59e0b;
  color: #fde68a;
}
body.dark-mode .book-agent-header-badge.has-new {
  background: rgba(124, 45, 18, 0.34);
  border-color: #f97316;
  color: #fdba74;
}
body.dark-mode .book-agent-header-badge.is-flash {
  box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.22);
}

body.dark-mode .workspace#agent-asset-studio {
    background-color: var(--bg-workspace-studio);
}

/* For Dark Mode */
body.dark-mode .streaming-code-preview {
    background-color: #2d3748;
    color: #e2e8f0;
}

/* ===============================================
   == DEFINITIVE FIX FOR DARK MODE SCROLLBAR    ==
   =============================================== */

/* กำหนดสไตล์ Scrollbar สำหรับ Dark Mode โดยเฉพาะ */
body.dark-mode *::-webkit-scrollbar {
    background: #21222c; /* สีพื้นหลังของราง Scrollbar */
    width: 12px;
}

body.dark-mode *::-webkit-scrollbar-thumb {
    background-color: #718096;  /* สีของตัวเลื่อน */
    border-radius: 6px;
    border: 3px solid #21222c; /* สีเดียวกับพื้นหลังของรางเพื่อสร้างเอฟเฟกต์ padding */
}

body.dark-mode *::-webkit-scrollbar-thumb:hover {
    background-color: #a0aec0; /* สีตอนเอาเมาส์ไปวาง */
}

body.dark-mode .item-list > .item.active:hover {
    background-color: #2c4736; /* ใช้สีเดียวกับ .active */
    border-color: var(--success-color);
}

/*
  Fix for Chat Action Buttons on Dark Theme
*/
body.dark-mode .message-actions button {
  color: var(--text-dark); /* <-- ตัวแปรนี้จะเป็นสีขาวนวลใน Dark Mode */
}

body.dark-mode .message-actions button:hover {
  background-color: rgba(255, 255, 255, 0.1); /* <-- ทำให้มีพื้นหลังจางๆ ตอน hover */
}

body.dark-mode .message.user .message-actions button {
  color: var(--text-dark); /* บังคับให้ปุ่มของ User เป็นสีขาวในโหมดมืด */
}

/* --- Timestamp color for Dark Theme (Definitive) --- */
body.dark-mode .message-timestamp {
  color: #64748b; /* สีจางๆ ที่สวยงามสำหรับ Dark theme */
}

body.dark-mode .speaker-info-wrapper .speaker-label {
    color: var(--primary-color);
}

/*
  Fix for hyperlink color in Composer on Dark Theme
*/
body.dark-mode .composer-editor {
  color: var(--text-dark);
}

body.dark-mode .composer-editor .ProseMirror {
  color: inherit;
  caret-color: var(--text-dark);
}

body.dark-mode .composer-editor .ProseMirror p.is-editor-empty:first-child::before {
  color: #94a3b8;
}

body.dark-mode #composer-editor .composer-content-area a,
body.dark-mode .composer-editor .ProseMirror a {
  color: #90caf9; /* << ใช้สีฟ้าสว่างสีเดียวกันกับใน Bubble */
  text-decoration: underline;
}

body.dark-mode #composer-editor .composer-content-area a:hover,
body.dark-mode .composer-editor .ProseMirror a:hover {
  color: #bbdefb; /* << สีตอน hover ก็ใช้สีเดียวกัน */
}

body.dark-mode .tab-btn {
    color: var(--text-dark);
}

body.dark-mode .selected-entity-section {
    background: #1f2937;
    border-color: #3f4a5c;
    box-shadow: none;
}

body.dark-mode #studio-panel .studio-assets-container > .collapsible-section {
    background: #1f2937;
    border-color: #3f4a5c;
}

body.dark-mode #studio-panel .studio-assets-container > .collapsible-section > .section-header {
    background: #253142;
    border-bottom-color: #3f4a5c;
}

body.dark-mode #studio-panel .studio-assets-container > .collapsible-section > .section-box {
    background: #1f2937;
}

body.dark-mode #studio-panel .studio-visibility-heading {
    color: #94a3b8;
}

body.dark-mode #studio-panel .studio-visibility-option.is-selected {
    background: #334155;
    color: #e2e8f0;
}

body.dark-mode #studio-panel .studio-visibility-check {
    color: #93c5fd;
}

body.dark-mode #studio-panel .studio-world-focus-card,
body.dark-mode #studio-panel .studio-world-quick-actions {
    background: #111827;
    border-color: #334155;
}

body.dark-mode #studio-panel .studio-world-quick-actions {
    border-color: #475569;
}

body.dark-mode #studio-panel .studio-world-focus-meta,
body.dark-mode #studio-panel .studio-world-inline-note,
body.dark-mode #studio-panel .studio-world-item-meta {
    color: #94a3b8;
}

body.dark-mode #studio-panel .studio-world-pill {
    background: #1f2937;
    border-color: #475569;
    color: #e2e8f0;
}

body.dark-mode #studio-panel .studio-world-pill.is-active {
    background: #123a2a;
    border-color: #166534;
    color: #bbf7d0;
}

body.dark-mode #studio-panel .studio-world-pill.is-linked {
    background: #172554;
    border-color: #1d4ed8;
    color: #bfdbfe;
}

body.dark-mode #studio-panel .studio-world-pill.is-pending {
    background: #3a2a12;
    border-color: #b45309;
    color: #fde68a;
}

body.dark-mode #studio-panel .studio-world-pill.is-danger {
    background: #3b1111;
    border-color: #b91c1c;
    color: #fecaca;
}

body.dark-mode #studio-panel .studio-world-pill.is-muted {
    background: #111827;
    border-color: #334155;
    color: #cbd5e1;
}

body.dark-mode #studio-panel .studio-world-preview {
    border-top-color: #334155;
}

body.dark-mode #studio-panel .studio-world-change-reason {
    border-top-color: #334155;
}

body.dark-mode #studio-panel .studio-world-reviewed-block {
    background: #111827;
    border-color: #334155;
}

body.dark-mode #studio-panel .studio-world-reviewed-block > summary {
    background: #1f2937;
    border-bottom-color: #334155;
}

body.dark-mode #book-sidebar-slot > .collapsible-section,
body.dark-mode .world-workspace-content > .collapsible-section {
    background: #1f2937;
    border-color: #3f4a5c;
}

body.dark-mode #book-sidebar-slot > .collapsible-section > .section-header,
body.dark-mode .world-workspace-content > .collapsible-section > .section-header {
    background: #253142;
    border-bottom-color: #3f4a5c;
}

body.dark-mode #book-sidebar-slot > .collapsible-section > .section-box,
body.dark-mode .world-workspace-content > .collapsible-section > .section-box {
    background: #1f2937;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-focus-card,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-quick-actions {
    background: #111827;
    border-color: #334155;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-quick-actions {
    border-color: #475569;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-focus-meta,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-note,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-item-meta {
    color: #94a3b8;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .book-changes-actions.is-secondary {
    border-top-color: #334155;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .book-changes-setup-note {
    border-color: #475569;
    background: #0f172a;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-block {
    border-top-color: #334155;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-heading,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-text {
    color: #e2e8f0;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-row {
    border-color: #334155;
    background: #111827;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-row.is-warning {
    border-color: #92400e;
    background: #2a1f11;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-continuity-row.is-info {
    border-color: #1d4ed8;
    background: #101f3a;
}

body.dark-mode #studio-panel .studio-world-continuity-block {
    border-top-color: #334155;
}

body.dark-mode #studio-panel .studio-world-continuity-heading,
body.dark-mode #studio-panel .studio-world-continuity-text {
    color: #e2e8f0;
}

body.dark-mode #studio-panel .studio-world-continuity-row {
    border-color: #334155;
    background: #111827;
}

body.dark-mode #studio-panel .studio-world-continuity-row.is-warning {
    border-color: #92400e;
    background: #2a1f11;
}

body.dark-mode #studio-panel .studio-world-continuity-row.is-info {
    border-color: #1d4ed8;
    background: #101f3a;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill {
    background: #1f2937;
    border-color: #475569;
    color: #e2e8f0;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill.is-active {
    background: #123a2a;
    border-color: #166534;
    color: #bbf7d0;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill.is-linked {
    background: #172554;
    border-color: #1d4ed8;
    color: #bfdbfe;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill.is-pending {
    background: #3a2a12;
    border-color: #b45309;
    color: #fde68a;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill.is-danger {
    background: #3b1111;
    border-color: #b91c1c;
    color: #fecaca;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-pill.is-muted {
    background: #111827;
    border-color: #334155;
    color: #cbd5e1;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-editor {
    background: #0f172a;
    border-color: #334155;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-field,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-checkbox {
    color: #cbd5e1;
}

body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-input,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-select,
body.dark-mode :is(#world-workspace, #book-sidebar-slot, #book-workspace) .studio-world-inline-textarea {
    background: #111827;
    border-color: #475569;
    color: #e5e7eb;
}

body.dark-mode #book-sidebar-slot .book-tree-book-block {
    background: #111827;
    border-color: #334155;
}

body.dark-mode #book-sidebar-slot .book-tree-book-block.is-active-book {
    border-color: #1d4ed8;
    box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.2);
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-book {
    background: #172030;
    border-bottom-color: #334155;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-book.active {
    background: #152844;
}

body.dark-mode #book-sidebar-slot .book-tree-collapse-toggle {
    color: #94a3b8;
}

body.dark-mode #book-sidebar-slot .book-tree-collapse-toggle:hover {
    background: #243244;
    color: #dbeafe;
}

body.dark-mode #book-sidebar-slot .book-tree-collapse-toggle:focus-visible {
    outline-color: #3b82f6;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-act {
    background: #101826;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-chapter {
    background: #111827;
    border-top-color: #243244;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-chapter:hover {
    background: #162131;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-chapter.is-drop-before::before,
body.dark-mode #book-sidebar-slot .book-tree-row.is-chapter.is-drop-after::after {
    background: #60a5fa;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-chapter.active {
    background: #172554;
}

body.dark-mode #book-sidebar-slot .book-tree-row-primary {
    color: #e5e7eb;
}

body.dark-mode #book-sidebar-slot .book-tree-row.is-act .book-tree-row-primary {
    color: #94a3b8;
}

body.dark-mode #book-sidebar-slot .book-tree-row-secondary {
    color: #94a3b8;
}

body.dark-mode #book-sidebar-slot .book-tree-act-block + .book-tree-act-block .book-tree-row.is-act {
    border-top-color: #243244;
}

body.dark-mode #book-sidebar-slot .book-tree-empty {
    background: #0f172a;
    border-color: #334155;
    color: #94a3b8;
}

body.dark-mode .book-workspace-header {
    background: rgba(15, 23, 42, 0.92);
    border-color: #334155;
}

body.dark-mode .book-workspace-heading p {
    color: #94a3b8;
}

body.dark-mode .book-workspace-tab-btn {
    background: #0f172a;
    border-color: #334155;
    color: #cbd5e1;
}

body.dark-mode .book-workspace-tab-btn:hover {
    background: #172554;
    border-color: #3b82f6;
    color: #dbeafe;
}

body.dark-mode .book-workspace-tab-btn.active {
    background: #1e3a8a;
    border-color: #60a5fa;
    color: #eff6ff;
}

body.dark-mode .book-overview-act-column,
body.dark-mode .book-composer-doc-card {
    background: #111827;
    border-color: #334155;
}

body.dark-mode .book-overview-toolbar {
    background: #0f172a;
    border-color: #334155;
}

body.dark-mode .book-overview-toolbar-meta {
    color: #cbd5e1;
}

body.dark-mode .book-composer-doc-card.is-selectable:hover {
    background: #152034;
    border-color: #3b82f6;
}

body.dark-mode .book-composer-doc-card.is-selectable.active {
    background: #172554;
    border-color: #2563eb;
}

body.dark-mode .book-overview-act-title,
body.dark-mode .book-composer-doc-title,
body.dark-mode .book-overview-chapter-title {
    color: #e5e7eb;
}

body.dark-mode .book-overview-act-meta,
body.dark-mode .book-overview-chapter-kicker,
body.dark-mode .book-composer-doc-meta {
    color: #94a3b8;
}

body.dark-mode .book-composer-editor {
    background: rgba(15, 23, 42, 0.9);
    border-color: #334155;
}

body.dark-mode .book-composer-active-doc-title {
    color: #e5e7eb;
}

body.dark-mode .book-composer-active-doc-meta {
    color: #94a3b8;
}

body.dark-mode .book-composer-export-card {
    background: #0f172a;
    border-color: #334155;
}

body.dark-mode .book-composer-export-title {
    color: #cbd5e1;
}

body.dark-mode .book-overview-chapter-card {
    background: #0f172a;
    border-color: #334155;
}

body.dark-mode .book-overview-chapter-card.is-active {
    background: #111f3a;
    border-color: #2563eb;
}

body.dark-mode .book-overview-chapter-summary {
    color: #cbd5e1;
}

body.dark-mode .book-overview-empty {
    background: #0f172a;
    border-color: #334155;
    color: #94a3b8;
}

body.dark-mode .world-book-settings-modal-meta {
    color: #94a3b8;
}

body.dark-mode #world-workspace .studio-world-preview,
body.dark-mode #world-workspace .studio-world-change-reason {
    border-top-color: #334155;
}

body.dark-mode #world-workspace .studio-world-change-diff {
    background: #0f172a;
    border-color: #334155;
}

body.dark-mode #world-workspace .studio-world-change-diff > summary {
    background: #111827;
    border-bottom-color: #334155;
}

body.dark-mode #world-workspace .studio-world-change-diff-key {
    color: #cbd5e1;
}

body.dark-mode #world-workspace .studio-world-change-diff-value {
    background: #111827;
    border-color: #475569;
    color: #e5e7eb;
}

body.dark-mode #world-workspace .studio-world-change-diff-value.is-before {
    background: #2b1b10;
    border-color: #9a3412;
}

body.dark-mode #world-workspace .studio-world-change-diff-value.is-after {
    background: #10261d;
    border-color: #047857;
}

body.dark-mode #world-workspace .studio-world-change-evidence {
    border-top-color: #334155;
    color: #94a3b8;
}

body.dark-mode #world-workspace .studio-world-reviewed-block {
    background: #111827;
    border-color: #334155;
}

body.dark-mode #world-workspace .studio-world-reviewed-block > summary {
    background: #1f2937;
    border-bottom-color: #334155;
}

body.dark-mode .world-workspace-header {
    background: #111827;
    border-color: #334155;
}

body.dark-mode .world-workspace-heading p {
    color: #94a3b8;
}

body.dark-mode .studio-selected-entity-slot {
    background: #1e293b;
    border-bottom-color: #334155;
}

body.dark-mode .selected-entity-source {
    color: #9ca3af;
}

body.dark-mode .selected-entity-badge.is-active {
    color: #bbf7d0;
    background: #123a2a;
    border-color: #166534;
}

body.dark-mode .selected-entity-badge.is-pending {
    color: #fde68a;
    background: #3a2a12;
    border-color: #b45309;
}

body.dark-mode .selected-entity-current {
    border-color: #334155;
    background: #0f172a;
}

body.dark-mode .selected-entity-current.is-active-entity {
    border-color: #166534;
    background: #0f2f21;
    box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.28) inset;
}

/* Override compact light-theme green styles (higher specificity) */
body.dark-mode .selected-entity-section.is-compact .selected-entity-current.is-active-entity {
    border-color: #166534;
    background: #0f2f21;
    box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.28) inset;
}

body.dark-mode .selected-entity-current.is-missing {
    border-color: #f59e0b;
    background: #3a2a12;
}

body.dark-mode .selected-entity-name {
    color: #e5e7eb;
}

body.dark-mode .selected-entity-section.is-compact .selected-entity-current.is-active-entity .selected-entity-name {
    color: #f0fdf4;
}

body.dark-mode .selected-entity-meta,
body.dark-mode .selected-entity-empty {
    color: #cbd5e1;
}

body.dark-mode .selected-entity-pending {
    border-top-color: #334155;
}

body.dark-mode .selected-entity-pending-text {
    color: #fbbf24;
}

body.dark-mode .selected-entity-pending-hint {
    color: #fcd34d;
}
